% Preamble {{{1
% There's some issue that causes captions like "Listing 2.: Foo".  setting the `numbers`
% option like this fixes it.  See <https://tex.stackexchange.com/q/29181>.
\documentclass[a4paper,numbers=noenddot]{scrartcl}

\usepackage[utf8]{inputenc} % Assume this file is encoded in UTF-8.
\usepackage[T1]{fontenc}    % Don't fake umlauts etc.
\usepackage{lmodern}        % Use the lmodern font (http://tex.stackexchange.com/a/65103).
\usepackage{microtype}      % Better microtypography (http://ctan.org/pkg/microtype)
\usepackage{comment}        % Comment out sections of text.
\usepackage{mathtools}      % Improved facilities for typesetting mathematical formulae
\usepackage{dirtytalk}      % ...

% Prevent floats from moving into another section (https://ctan.org/pkg/placeins).
\usepackage[above, below, section]{placeins}

% Stack for cross-referencing.  XXX: the packages have to be loaded in this order (see the
% cleveref manual).
% * The [varioref] package adds commands that automatically print the target's page number
%   iff it is on a different page than the reference.
% * [hyperref] turns references into clickable hyperlinks.
% * Among other things, [cleveref] adds commands that include the type of the referenced
%   object.  Instead of `figure~\ref{fig:foo}`, one can write `\cref{fig:foo}`.  It also
%   enhances the varioref commands accordingly.
% See [1], [2], and [3].
%
% [varioref]: https://ctan.org/pkg/varioref
% [hyperref]: https://ctan.org/pkg/hyperref
% [cleveref]: https://ctan.org/pkg/cleveref
% [1]: https://en.wikibooks.org/wiki/LaTeX/Labels_and_Cross-referencing
% [2]: https://tex.stackexchange.com/q/83037
%      "Difference between ref, varioref and cleveref."
% [3]: https://tex.stackexchange.com/q/36295
%      "Cross-reference packages: which to use, which conflict?"
\usepackage{varioref}
\usepackage{hyperref} % XXX: load before `glossaries`
\usepackage{cleveref} % Use `\cref{fig:foo}` instead of `figure~\ref{fig:foo}`.

% Stack for generating tables from CSV files.  Loading is done by [pgfplotstable].  It can
% also round, format and post-process data.  See [1].
% [siunitx] adds the `S` column type for advanced aligning in tables like around the
% decimal marker.  Getting this to work is a bit tricky; see [2].  There is some support
% for aligning around the decimal marker in [pgfplotstable] (see [3]), but I couldn't get
% it to work.  One can also right-align numbers relatively to each other but still center
% the column as a whole with [siunitx] (see [4]).
% [pgfplotstable]: https://ctan.org/pkg/pgfplotstable
% [siunitx]: https://ctan.org/pkg/siunitx
% [1]: https://tex.stackexchange.com/q/146716
% [2]: https://tex.stackexchange.com/q/131081
% [3]: https://tex.stackexchange.com/q/276485
% [4]: https://tex.stackexchange.com/q/9203
\usepackage{pgfplotstable, siunitx}
% These packages are recommended by [pgfplotstable].  The booktabs package adds the
% `\toprule`, `\midrule`, and `\bottomrule` commands for better looking tables.  See [5].
\usepackage{booktabs, array, colortbl}
% [booktabs]: https://ctan.org/pkg/booktabs
% [5]: https://en.wikibooks.org/wiki/LaTeX/Tables#Professional_tables

% Use a consitent group/thousands separator for siunitx and pgf.
\pgfkeys{/pgf/number format/.cd,
   set thousands separator=\,
}
% \sisetup{
%    group-separator={,}
% }

% Provides the `\captionof` command for typesetting captions outside of floats, which is
% an extension of th one provided by [capt-of](https://ctan.org/pkg/capt-of).  Includes
% the [newfloat package](https://ctan.org/pkg/newfloat), which minted is set up to use.
\usepackage{caption} % See <https://ctan.org/pkg/caption>.
% \captionsetup{labelsep=colon}

% See <https://tex.stackexchange.com/q/10684/78512>.  TODO.
\usepackage{enumitem}
\setlist{noitemsep}

% TODO.  See <https://tex.stackexchange.com/q/119513>.
\crefname{appsec}{Appendix}{Appendices}

% Use ISO 8601, like a reasonable person.  See <https://tex.stackexchange.com/a/152394>.
\usepackage[style=iso]{datetime2}

% TODO: will this just force LaTeX to make worse choices?
% \usepackage[all]{nowidow}

% Source code listings with improved syntax highlighting
\usepackage[newfloat]{minted}
\usemintedstyle{pastie}

% Define a background color for `minted` listings.  See <http://ctan.org/pkg/minted> and
% <https://tex.stackexchange.com/q/150369>.
\usepackage{xcolor}
\definecolor{bg}{rgb}{0.95,0.95,0.95}
\setminted{bgcolor=bg}
% Don't shade the background when using `mintinline`.
\setmintedinline{bgcolor={}}

% ...
\usepackage[titletoc]{appendix}

% Keep using ISO 8601 consistently, like an even more reasonable person.  See
% <https://tex.stackexchange.com/q/231208>.
\usepackage[date=edtf, urldate=edtf, seconds=true]{biblatex}
\addbibresource{paper.bib}

\usepackage[xindy, toc, acronym]{glossaries} % Load after `hyperref`.

\makeglossaries
\loadglsentries{tex/glossary}

\usepackage{tikz}
\usetikzlibrary{datavisualization}
% \usetikzlibrary{datavisualization.formats.functions}

% See <https://tex.stackexchange.com/a/155317>, <https://tex.stackexchange.com/a/320521>
% and <https://tex.stackexchange.com/a/75507>.
% \usepackage{tikzscale}

\newcommand*{\article}{article} % report, paper?

% Define a command that takes exactly 2 arguments, the first one defaulting to `1`.  The
% second argument should be a list of items separated by `,`.  The list item at the
% position specified by the first argument in printed.  See
% <https://tex.stackexchange.com/a/99271>,
% <http://mirrors.ctan.org/macros/generic/listofitems/listofitems-en.pdf>, and
% <https://tex.stackexchange.com/q/276697>.
\usepackage{listofitems}
\newcommand*{\alts}[2][1]{%
   \setsepchar{,}%
   \readlist*\arg{#2}%
   \arg[#1]%
}

% X (cross) something out.  See <https://tex.stackexchange.com/a/276698>.
\newcommand{\x}[1]{\ignorespaces}

% Top matter {{{1
\title{Basics of Hardware Cache Optimization}
% \title{Algorithms for Hardware Caches}
% \title{Basics of CPU Cache Optimization}
% \title{Basics of Optimizing for Hardware Caches}
% \title{Fundamentals of Optimizing for Hardware Caches}
% \title{Introduction to Optimizations for Hardware Caches}
% \title{Optimizing for Hardware Caches}
% \subtitle{The Basics}
\author{Lukas Waymann}

% Body {{{1
\begin{document}
\maketitle

% \newpage

\begin{abstract}
   % What?
   Typical present-day CPUs have two or more levels of caches.  This \article{} presents
   the basic techniques used to optimize program performance based on knowledge about how
   these hardware caches function.

   The abstract \gls{emm} for memory hierarchies is explained and a small selection of
   algorithms \alts{developed for it, analyzed under it} are explored mathematically and
   empirically.
\end{abstract}
\newpage

\tableofcontents
\newpage

\glsresetall % Reset the use status of all acronyms.

\input{tex/intro}
\input{tex/motivation}
\input{tex/types}
\input{tex/basic-concepts}

\section{Example: \texttt{std::vector} vs. \texttt{std::list}}
\label{sec:vvl}

% \section{Cache Replacement Policies} % Eviction Policies/Strategies/Algorithms
% https://en.wikipedia.org/wiki/Cache_replacement_policies

\section{External Memory Model}
The \gls{emm} is a widely used
% TODO: is it?
extension of the \gls{ram} model.

\begin{listing}
   \inputminted[firstline=8]{c}{array-sum/array-sum.c}
   \caption{This is C code}
   \label{lst:array-sum}
\end{listing}

% This program is likely to have excellent spatial locality: the array...

% \begin{figure}[htb]
\begin{figure}
   \centering
   \begin{tikzpicture}
      \datavisualization
      [scientific axes=clean,
       x axis={label={Array size (KiB)}, length=0.8\textwidth},
       y axis={label={Processor time (ms)}, length=6cm},
       visualize as scatter,
       scatter={style={mark=*, mark options={scale=.65}}}]
         % See <https://tex.stackexchange.com/q/198323>.
         data [read from file=array-sum/size-time.csv, separator=\space];
   \end{tikzpicture}
   \caption{This figure took way too long to create}
   \label{fig:array-sum}
\end{figure}

% See \cref{fig:array-sum}.  What's going on here?

\section{Cache-Oblivious Algorithms} % Cache-Oblivious Model

\section{Parallel Computing}

\subsection{Cache Coherence} % Coherence or coherency?
% https://en.wikipedia.org/wiki/Cache_coherence
% Dirty.  Invalid.

\subsection{False Sharing}

\clearpage
\begin{appendices} % <https://tex.stackexchange.com/q/49643>
   \crefalias{section}{appsec} % See <https://tex.stackexchange.com/q/119513>.
   \crefalias{subsection}{appsec}
   \input{tex/cpu-info}
   \input{tex/methodology}
   \input{tex/data}
   % \input{tex/no-prefetch}
\end{appendices}

\clearpage

\printglossary[type=\acronymtype] % Print the list of acronyms.

\printbibliography[heading=bibintoc]

\end{document}

% vim: tw=90 sts=-1 sw=3 et fdm=marker
