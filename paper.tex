% Preamble {{{1
% See <https://tex.stackexchange.com/q/29181>.  There's some issue that causes captions
% like "Listing 2.: Foo".  setting the `numbers` option like this fixes it.
\documentclass[a4paper,numbers=noenddot]{scrartcl}

\usepackage[utf8]{inputenc} % Assume this file is encoded in UTF-8.
\usepackage[T1]{fontenc}    % Don't fake umlauts etc.
\usepackage{lmodern}        % Use the lmodern font (http://tex.stackexchange.com/a/65103).
\usepackage{microtype}      % Better microtypography (http://www.ctan.org/pkg/microtype)
\usepackage{hyperref}       % Clickable hyperlinks, load before `glossaries`
\usepackage{cleveref}       % Use `\cref{fig:foo}` instead of `figure~\ref{fig:foo}`.
                            % Load after `hyperref`.  See
                            % <https://tex.stackexchange.com/q/36295>
\usepackage{comment}        % Comment out sections of text.
\usepackage{mathtools}      % Improved facilities for typesetting mathematical formulae
\usepackage{dirtytalk}      % ...

% Prevent floats from moving into another section (https://www.ctan.org/pkg/placeins).
\usepackage[above, below, section]{placeins}

% Provides the `\captionof` command for typesetting captions outside of floats.  Includes
% the [newfloat package](https://www.ctan.org/pkg/newfloat), which minted is set up to
% use.
\usepackage{caption} % See <https://www.ctan.org/pkg/caption>.
% \captionsetup{labelsep=colon}

% See <https://tex.stackexchange.com/q/10684/78512>.  TODO.
\usepackage{enumitem}
\setlist{noitemsep}

% TODO.  See <https://tex.stackexchange.com/q/119513>.
\crefname{appsec}{Appendix}{Appendices}

% Use ISO 8601, like a reasonable person.  See <https://tex.stackexchange.com/a/152394>.
\usepackage[style=iso]{datetime2}

% TODO: will this just force LaTeX to make worse choices?
% \usepackage[all]{nowidow}

% Source code listings with improved syntax highlighting
\usepackage[newfloat]{minted}
\usemintedstyle{pastie}

% Define a background color for `minted` listings.  See <http://ctan.org/pkg/minted> and
% <https://tex.stackexchange.com/q/150369>.
\usepackage{xcolor}
\definecolor{bg}{rgb}{0.95,0.95,0.95}
\setminted{bgcolor=bg}
% Don't shade the background when using `mintinline`.
\setmintedinline{bgcolor={}}

% ...
\usepackage[titletoc]{appendix}

% Keep using ISO 8601 consistently, like an even more reasonable person.  See
% <https://tex.stackexchange.com/q/231208>.
\usepackage[date=edtf, urldate=edtf, seconds=true]{biblatex}
\addbibresource{paper.bib}

\usepackage[xindy, toc, acronym]{glossaries} % Load after `hyperref`.

\makeglossaries
\loadglsentries{tex/glossary}

\usepackage{tikz}
\usetikzlibrary{datavisualization}
% \usetikzlibrary{datavisualization.formats.functions}

% See <https://tex.stackexchange.com/a/155317>, <https://tex.stackexchange.com/a/320521>
% and <https://tex.stackexchange.com/a/75507>.
% \usepackage{tikzscale}

\newcommand*{\article}{article} % report, paper?

% Define a command that takes exactly 2 arguments, the first one defaulting to `1`.  The
% second argument should be a list of items separated by `,`.  The list item at the
% position specified by the first argument in printed.  See
% <https://tex.stackexchange.com/a/99271>,
% <http://mirrors.ctan.org/macros/generic/listofitems/listofitems-en.pdf>, and
% <https://tex.stackexchange.com/q/276697>.
\usepackage{listofitems}
\newcommand*{\alts}[2][1]{%
   \setsepchar{,}%
   \readlist*\arg{#2}%
   \arg[#1]%
}

% Top matter {{{1
\title{Basics of Hardware Cache Optimization}
% \title{Algorithms for Hardware Caches}
% \title{Basics of CPU Cache Optimization}
% \title{Basics of Optimizing for Hardware Caches}
% \title{Fundamentals of Optimizing for Hardware Caches}
% \title{Introduction to Optimizations for Hardware Caches}
% \title{Optimizing for Hardware Caches}
% \subtitle{The Basics}
\author{Lukas Waymann}

% Body {{{1
\begin{document}
\maketitle

% \newpage

\begin{abstract}
   % What?
   Typical present-day CPUs have two or more levels of caches.  This \article{} presents
   the basic techniques used to optimize program performance based on knowledge about how
   these hardware caches function.

   The abstract \gls{emm} for memory hierarchies is explained and a small selection of
   algorithms \alts{developed for it, analyzed under it} are explored mathematically and
   empirically.
\end{abstract}
\newpage

\tableofcontents
\newpage

\glsresetall % Reset the use status of all acronyms.

\input{tex/intro}
\input{tex/motivation}
\input{tex/types}
\input{tex/basic-concepts}

\section{Example: \texttt{std::vector} vs. \texttt{std::list}}
\label{sec:vvl}

% \section{Cache Replacement Policies} % Eviction Policies/Strategies/Algorithms
% https://en.wikipedia.org/wiki/Cache_replacement_policies

\section{External Memory Model}
The \gls{emm} is a widely used
% TODO: is it?
extension of the \gls{ram} model.

\begin{listing}
   \inputminted[firstline=8]{c}{array-sum/array-sum.c}
   \caption{This is C code}
   \label{lst:array-sum}
\end{listing}

% This program is likely to have excellent spatial locality: the array...

% \begin{figure}[htb]
\begin{figure}
   \centering
   \begin{tikzpicture}
      \datavisualization
      [scientific axes=clean,
       x axis={label={Array size (KiB)}, length=0.8\textwidth},
       y axis={label={Processor time (ms)}, length=6cm},
       visualize as scatter,
       scatter={style={mark=*, mark options={scale=.65}}}]
         % See <https://tex.stackexchange.com/q/198323>.
         data [read from file=array-sum/size-time.csv, separator=\space];
   \end{tikzpicture}
   \caption{This figure took way too long to create}
   \label{fig:array-sum}
\end{figure}

% See \cref{fig:array-sum}.  What's going on here?

\section{Cache-Oblivious Algorithms} % Cache-Oblivious Model

\section{Parallel Computing}

\subsection{Cache Coherence} % Coherence or coherency?
% https://en.wikipedia.org/wiki/Cache_coherence
% Dirty.  Invalid.

\subsection{False Sharing}

\clearpage
\begin{appendices} % <https://tex.stackexchange.com/q/49643>
   \crefalias{section}{appsec} % See <https://tex.stackexchange.com/q/119513>.
   \crefalias{subsection}{appsec}
   \input{tex/cpu-info}
   \input{tex/methodology}
   % \input{tex/no-prefetch}
\end{appendices}

\clearpage

\printglossary[type=\acronymtype] % Print the list of acronyms.

\printbibliography[heading=bibintoc]

\end{document}

% vim: tw=90 sts=-1 sw=3 et fdm=marker
